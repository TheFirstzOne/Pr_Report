<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR Expense Monitoring Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .loading-spinner { 
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .chart-container { position: relative; height: 300px; }
        .status-badge { 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 12px; 
            font-weight: 600; 
        }
        .status-received { background-color: #d4edda; color: #155724; }
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-other { background-color: #f8d7da; color: #721c24; }
        
        /* Search Box Animations */
        .search-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        .search-input {
            width: 0;
            opacity: 0;
            transition: width 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
            overflow: hidden;
            border: none;
            outline: none;
            background: transparent;
        }
        .search-input.active {
            width: 200px;
            opacity: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .search-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .search-icon {
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px;
            border-radius: 0.375rem;
            color: #6b7280;
            border: none;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .search-icon:hover {
            background-color: #f3f4f6;
            color: #374151;
        }
        .search-icon.active {
            color: #3b82f6;
            background-color: #dbeafe;
        }
        .search-clear {
            position: absolute;
            right: 8px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease, color 0.2s ease;
            color: #6b7280;
            border: none;
            background: transparent;
            padding: 4px;
            border-radius: 50%;
        }
        .search-clear.show {
            opacity: 1;
        }
        .search-clear:hover {
            color: #ef4444;
            background-color: rgba(239, 68, 68, 0.1);
        }

        /* Multi-Status Filter Styles */
        .status-filter-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .status-filter-button {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 8px 12px;
            font-size: 0.875rem;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 160px;
            max-width: 200px;
        }
        
        .status-filter-button:hover {
            border-color: #9ca3af;
            background-color: #f9fafb;
        }
        
        .status-filter-button.active {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .status-filter-content {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            margin-top: 4px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            pointer-events: none;
            max-height: 280px;
            overflow-y: auto;
        }
        
        .status-filter-content.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        
        .status-filter-header {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            background-color: #f9fafb;
            border-radius: 0.5rem 0.5rem 0 0;
        }
        
        .status-filter-controls {
            display: flex;
            gap: 8px;
        }
        
        .status-filter-control-btn {
            padding: 4px 8px;
            font-size: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            background: white;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .status-filter-control-btn:hover {
            background-color: #f3f4f6;
            border-color: #9ca3af;
        }
        
        .status-filter-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        
        .status-filter-option:hover {
            background-color: #f3f4f6;
        }
        
        .status-filter-option input[type="checkbox"] {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            accent-color: #3b82f6;
        }
        
        .status-filter-option label {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .status-count {
            background-color: #e5e7eb;
            color: #6b7280;
            padding: 2px 6px;
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-filter-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .status-selected-count {
            background-color: #3b82f6;
            color: white;
            padding: 2px 6px;
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 4px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner"></div>
            <p class="text-gray-600 mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white p-6 shadow-lg">
            <div class="max-w-7xl mx-auto">
                <h1 class="text-3xl font-bold mb-2">üìä PR Expense Monitoring Dashboard</h1>
                <p class="text-blue-100">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ Purchase Request 2025</p>
            </div>
        </header>

        <main class="max-w-7xl mx-auto p-6">
            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Expense Card -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p>
                            <p id="totalExpense" class="text-2xl font-bold text-green-600">0 ‡∏ø</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Total Records Card -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p id="totalRecords" class="text-2xl font-bold text-blue-600">0</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- All PRs Card -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PR ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                            <p id="allPRsCount" class="text-2xl font-bold text-red-600">0</p>
                        </div>
                        <div class="bg-red-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Active Months Card -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500 mb-1">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                            <p id="activeMonths" class="text-2xl font-bold text-purple-600">0</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Monthly Expense Chart -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">üìà ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                    <div class="chart-container">
                        <canvas id="monthlyExpenseChart"></canvas>
                    </div>
                </div>

                <!-- Interactive PR Distribution Chart -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">üìä ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ PR</h3>
                        <div class="flex items-center space-x-2">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <select id="chartTypeSelector" class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="month">‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                                <option value="status">‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- All PRs Table with Enhanced Multi-Status Filter -->
            <div class="bg-white rounded-xl shadow-md mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PR ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà PR No. ‡∏ã‡πâ‡∏≥)</h3>
                        <div class="flex items-center space-x-4">
                            <!-- Sort Options -->
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path>
                                </svg>
                                <select id="sortOption" class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="date-asc">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡πÉ‡∏´‡∏°‡πà) + PR No.</option>
                                    <option value="date-desc">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πà‡∏≤) + PR No.</option>
                                    <option value="pr-asc">üìã PR No. (‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏°‡∏≤‡∏Å) + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</option>
                                    <option value="pr-desc">üìã PR No. (‡∏°‡∏≤‡∏Å ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢) + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</option>
                                    <option value="amount-desc">üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏°‡∏≤‡∏Å ‚Üí ‡∏ô‡πâ‡∏≠‡∏¢)</option>
                                    <option value="amount-asc">üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏ô‡πâ‡∏≠‡∏¢ ‚Üí ‡∏°‡∏≤‡∏Å)</option>
                                </select>
                            </div>
                            <!-- Month Filter -->
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <select id="monthFilter" class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="all">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                                </select>
                            </div>
                            
                            <!-- Enhanced Multi-Status Filter -->
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div class="status-filter-dropdown">
                                    <div id="statusFilterButton" class="status-filter-button">
                                        <span class="status-filter-text">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
                                        <svg class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                    <div id="statusFilterContent" class="status-filter-content">
                                        <div class="status-filter-header">
                                            <div class="status-filter-controls">
                                                <button id="selectAllStatus" class="status-filter-control-btn">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                                                <button id="clearAllStatus" class="status-filter-control-btn">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                                            </div>
                                        </div>
                                        <div id="statusFilterOptions">
                                            <!-- Options will be populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Search Box -->
                            <div class="flex items-center space-x-2">
                                <div class="search-container">
                                    <button 
                                        id="searchIcon" 
                                        class="search-icon" 
                                        title="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
                                        type="button"
                                    >
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                        </svg>
                                    </button>
                                    
                                    <div style="position: relative;">
                                        <input 
                                            type="text" 
                                            id="searchInput" 
                                            class="search-input" 
                                            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£..."
                                            autocomplete="off"
                                            spellcheck="false"
                                        >
                                        <button 
                                            id="searchClear" 
                                            class="search-clear" 
                                            title="‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤"
                                            type="button"
                                        >
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PR No.</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                            </tr>
                        </thead>
                        <tbody id="allPRsTable" class="bg-white divide-y divide-gray-200">
                            <!-- Table content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Monthly Summary Table -->
            <div class="bg-white rounded-xl shadow-md">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">üìÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">% ‡∏Ç‡∏≠‡∏á‡∏£‡∏ß‡∏°</th>
                            </tr>
                        </thead>
                        <tbody id="monthlySummaryTable" class="bg-white divide-y divide-gray-200">
                            <!-- Table content will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Key Insights -->
            <div class="mt-8 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">üí° ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å</h3>
                <div id="insights" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Insights will be populated by JavaScript -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6 mt-8">
            <div class="max-w-7xl mx-auto px-6 text-center">
                <p>&copy; 2025 PR Expense Monitoring Dashboard. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ Google Apps Script + Tailwind CSS</p>
            </div>
        </footer>
    </div>

    <script>
        // Global variables
        let dashboardData = null;
        let monthlyChart = null;
        let distributionChart = null;
        let selectedStatuses = new Set(['all']); // Track selected statuses

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î Dashboard...');
            loadDashboardData();
        });

        // Load data from Google Apps Script
        function loadDashboardData() {
            // *** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Google Apps Script - ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ***
            google.script.run
                .withSuccessHandler(onDataLoaded)
                .withFailureHandler(onDataError)
                .getPRData();
            
            // *** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö - ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ***
            // const sampleData = { ... }; // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
            // setTimeout(() => { onDataLoaded(sampleData); }, 1000);
        }

        // Handle successful data load
        function onDataLoaded(data) {
            console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', data);
            
            if (data.error) {
                onDataError(data.error);
                return;
            }

            dashboardData = data;
            
            // Update summary cards
            updateSummaryCards(data);
            
            // Create charts
            createMonthlyExpenseChart(data.monthlySummary);
            createDistributionChart(data.allPRs, data.monthlySummary, 'month');
            
            // Populate tables
            populateAllPRsTable(data.allPRs);
            populateMonthlySummaryTable(data.monthlySummary);
            
            // Create insights
            createInsights(data);
            
            // Setup filters
            setupMonthFilter(data.allPRs);
            setupMultiStatusFilter(data.allPRs); // New multi-status filter
            
            // Setup chart type selector
            setupChartTypeSelector(data.allPRs, data.monthlySummary);
            
            // Setup sorting function
            setupSortingFunction();
            
            // Setup search function
            setupSearchFunction();
            
            // Hide loading screen and show content
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        // Handle data load error
        function onDataError(error) {
            console.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:', error);
            document.getElementById('loadingScreen').innerHTML = `
                <div class="text-center">
                    <div class="text-red-500 text-6xl mb-4">‚ö†Ô∏è</div>
                    <h3 class="text-xl font-bold text-red-600 mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                    <p class="text-gray-600 mb-4">${error}</p>
                    <button onclick="location.reload()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                        ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                    </button>
                </div>
            `;
        }

        // Setup enhanced multi-status filter
        function setupMultiStatusFilter(allPRs) {
            console.log('üè∑Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Multi-Status Filter...');
            
            const statusFilterButton = document.getElementById('statusFilterButton');
            const statusFilterContent = document.getElementById('statusFilterContent');
            const statusFilterOptions = document.getElementById('statusFilterOptions');
            const selectAllBtn = document.getElementById('selectAllStatus');
            const clearAllBtn = document.getElementById('clearAllStatus');
            
            if (!statusFilterButton || !statusFilterContent || !statusFilterOptions) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö elements ‡∏Ç‡∏≠‡∏á multi-status filter');
                return;
            }
            
            // Count statuses
            const statusCounts = {};
            allPRs.forEach(pr => {
                const status = pr.status || 'UNKNOWN';
                statusCounts[status] = (statusCounts[status] || 0) + 1;
            });
            
            const uniqueStatuses = Object.keys(statusCounts).sort();
            console.log('üè∑Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏û‡∏ö:', uniqueStatuses, statusCounts);
            
            // Create options
            statusFilterOptions.innerHTML = uniqueStatuses.map(status => `
                <div class="status-filter-option">
                    <input type="checkbox" id="status_${status}" value="${status}" checked>
                    <label for="status_${status}">
                        <span>${status}</span>
                        <span class="status-count">${statusCounts[status]}</span>
                    </label>
                </div>
            `).join('');
            
            // Initialize selected statuses (all checked by default)
            selectedStatuses = new Set(uniqueStatuses);
            updateStatusFilterButtonText();
            
            // Toggle dropdown
            let isDropdownOpen = false;
            statusFilterButton.addEventListener('click', function(e) {
                e.stopPropagation();
                isDropdownOpen = !isDropdownOpen;
                
                if (isDropdownOpen) {
                    statusFilterContent.classList.add('show');
                    statusFilterButton.classList.add('active');
                    statusFilterButton.querySelector('svg').style.transform = 'rotate(180deg)';
                } else {
                    statusFilterContent.classList.remove('show');
                    statusFilterButton.classList.remove('active');
                    statusFilterButton.querySelector('svg').style.transform = 'rotate(0deg)';
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.status-filter-dropdown') && isDropdownOpen) {
                    statusFilterContent.classList.remove('show');
                    statusFilterButton.classList.remove('active');
                    statusFilterButton.querySelector('svg').style.transform = 'rotate(0deg)';
                    isDropdownOpen = false;
                }
            });
            
            // Prevent dropdown from closing when clicking inside options
            statusFilterContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // Handle checkbox changes
            statusFilterOptions.addEventListener('change', function(e) {
                if (e.target.type === 'checkbox') {
                    const statusValue = e.target.value;
                    
                    if (e.target.checked) {
                        selectedStatuses.add(statusValue);
                    } else {
                        selectedStatuses.delete(statusValue);
                    }
                    
                    updateStatusFilterButtonText();
                    applyFilters(dashboardData.allPRs);
                }
            });
            
            // Select all button
            selectAllBtn.addEventListener('click', function(e) {
                e.preventDefault();
                selectedStatuses = new Set(uniqueStatuses);
                
                // Check all checkboxes
                statusFilterOptions.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = true;
                });
                
                updateStatusFilterButtonText();
                applyFilters(dashboardData.allPRs);
            });
            
            // Clear all button
            clearAllBtn.addEventListener('click', function(e) {
                e.preventDefault();
                selectedStatuses.clear();
                
                // Uncheck all checkboxes
                statusFilterOptions.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                updateStatusFilterButtonText();
                applyFilters(dashboardData.allPRs);
            });
            
            // Update button text based on selections
            function updateStatusFilterButtonText() {
                const buttonText = statusFilterButton.querySelector('.status-filter-text');
                const selectedCount = selectedStatuses.size;
                const totalCount = uniqueStatuses.length;
                
                if (selectedCount === 0) {
                    buttonText.innerHTML = '‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
                    buttonText.style.color = '#ef4444';
                } else if (selectedCount === totalCount) {
                    buttonText.innerHTML = '‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
                    buttonText.style.color = '';
                } else if (selectedCount === 1) {
                    const singleStatus = Array.from(selectedStatuses)[0];
                    buttonText.innerHTML = singleStatus;
                    buttonText.style.color = '';
                } else {
                    buttonText.innerHTML = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${selectedCount} ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ <span class="status-selected-count">${selectedCount}</span>`;
                    buttonText.style.color = '';
                }
            }
            
            console.log('‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Multi-Status Filter ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }

        // Update summary cards
        function updateSummaryCards(data) {
            document.getElementById('totalExpense').textContent = formatCurrency(data.totalExpense);
            document.getElementById('totalRecords').textContent = formatNumber(data.totalRecords);
            document.getElementById('allPRsCount').textContent = formatNumber(data.uniquePRCount || 0);
            document.getElementById('activeMonths').textContent = formatNumber(data.monthlySummary.length);
        }

        // Create monthly expense chart
        function createMonthlyExpenseChart(monthlySummary) {
            const ctx = document.getElementById('monthlyExpenseChart').getContext('2d');
            
            if (monthlyChart) {
                monthlyChart.destroy();
            }
            
            monthlyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthlySummary.map(item => item.month.split(' ')[0]),
                    datasets: [{
                        label: '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)',
                        data: monthlySummary.map(item => item.totalExpense),
                        backgroundColor: 'rgba(59, 130, 246, 0.8)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create distribution chart
        function createDistributionChart(allPRs, monthlySummary, type = 'month') {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            let chartData, chartLabels, colors;
            
            if (type === 'month') {
                chartLabels = monthlySummary.map(month => month.month.split(' ')[0]);
                chartData = monthlySummary.map(month => month.uniquePRCount || 0);
                colors = [
                    '#3B82F6', '#EF4444', '#10B981', '#F59E0B', 
                    '#8B5CF6', '#EC4899', '#06B6D4', '#84CC16',
                    '#F97316', '#6366F1', '#14B8A6', '#F43F5E'
                ];
            } else {
                const statusPRs = {};
                allPRs.forEach(pr => {
                    const status = pr.status || 'UNKNOWN';
                    if (!statusPRs[status]) {
                        statusPRs[status] = new Set();
                    }
                    statusPRs[status].add(pr.prNo);
                });
                
                chartLabels = Object.keys(statusPRs);
                chartData = Object.values(statusPRs).map(prSet => prSet.size);
                colors = [
                    '#10B981', '#EF4444', '#F59E0B', '#8B5CF6', 
                    '#06B6D4', '#EC4899', '#84CC16', '#F97316'
                ];
            }
            
            distributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PR (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // Populate all PRs table
        function populateAllPRsTable(allPRs) {
            const tableBody = document.getElementById('allPRsTable');
            
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput ? searchInput.value.trim() : '';
            
            if (allPRs.length === 0) {
                let noDataMessage = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PR';
                
                if (searchTerm !== '') {
                    noDataMessage = `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö "${searchTerm}"`;
                }
                
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center">
                            <div class="flex flex-col items-center justify-center space-y-2">
                                <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                                <p class="text-gray-500 text-sm font-medium">${noDataMessage}</p>
                                ${searchTerm !== '' ? '<p class="text-gray-400 text-xs">‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>' : ''}
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            function highlightSearchTerm(text, term) {
                if (!term || !text) return text;
                
                const regex = new RegExp(`(${term})`, 'gi');
                return text.replace(regex, '<mark class="bg-yellow-200 px-1 rounded font-medium">$1</mark>');
            }
            
            tableBody.innerHTML = allPRs.map(pr => `
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${pr.prNo || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${pr.date || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</td>
                    <td class="px-6 py-4 text-sm text-gray-900 max-w-xs">${highlightSearchTerm(pr.item || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏', searchTerm)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${pr.qty || ''} ${pr.unit || ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold ${(pr.amount || 0) > 20000 ? 'text-red-600' : 'text-blue-600'}">${formatCurrency(pr.amount || 0)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="status-badge ${getStatusClass(pr.status || 'UNKNOWN')}">${pr.status || 'UNKNOWN'}</span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600 max-w-xs truncate" title="${pr.remark || ''}">${pr.remark || '-'}</td>
                </tr>
            `).join('');
        }

        // Populate monthly summary table
        function populateMonthlySummaryTable(monthlySummary) {
            const tableBody = document.getElementById('monthlySummaryTable');
            
            tableBody.innerHTML = monthlySummary.map(month => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${month.month}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-blue-600">${formatCurrency(month.totalExpense)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatNumber(month.recordCount)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(month.maxExpense)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${month.percentage.toFixed(1)}%</td>
                </tr>
            `).join('');
        }

        // Create insights
        function createInsights(data) {
            const insightsContainer = document.getElementById('insights');
            const maxExpenseMonth = data.monthlySummary.reduce((max, month) => 
                month.totalExpense > max.totalExpense ? month : max, data.monthlySummary[0]);
            
            const maxPR = data.allPRs.length > 0 ? 
                data.allPRs.reduce((max, pr) => pr.amount > max.amount ? pr : max) : null;
            
            const highValuePRs = data.allPRs.filter(pr => pr.amount > 20000);
            const uniqueHighValuePRs = new Set(highValuePRs.map(pr => pr.prNo));
            const avgExpensePerPR = data.uniquePRCount > 0 ? data.totalExpense / data.uniquePRCount : 0;
            
            insightsContainer.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-600">${maxExpenseMonth.percentage.toFixed(1)}%</div>
                    <div class="text-sm text-gray-600">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (${maxExpenseMonth.month.split(' ')[0]})</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-red-600">${maxPR ? formatCurrency(maxPR.amount) : '0 ‡∏ø'}</div>
                    <div class="text-sm text-gray-600">PR ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600">${uniqueHighValuePRs.size}</div>
                    <div class="text-sm text-gray-600">PR ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ > 20K (Unique)</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-600">${formatCurrency(avgExpensePerPR)}</div>
                    <div class="text-sm text-gray-600">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠ PR (Unique)</div>
                </div>
            `;
        }

        // Setup chart type selector
        function setupChartTypeSelector(allPRs, monthlySummary) {
            const chartTypeSelector = document.getElementById('chartTypeSelector');
            
            chartTypeSelector.addEventListener('change', function() {
                const selectedType = this.value;
                createDistributionChart(allPRs, monthlySummary, selectedType);
                
                const chartTitle = this.closest('.bg-white').querySelector('h3');
                if (selectedType === 'month') {
                    chartTitle.textContent = 'üìä ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ PR - ‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
                } else {
                    chartTitle.textContent = 'üìä ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ PR - ‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
                }
            });
            
            const chartTitle = chartTypeSelector.closest('.bg-white').querySelector('h3');
            chartTitle.textContent = 'üìä ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ PR - ‡πÅ‡∏ö‡πà‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
        }

        // Setup sorting function
        function setupSortingFunction() {
            const sortOption = document.getElementById('sortOption');
            
            if (sortOption) {
                sortOption.value = 'date-asc';
                
                sortOption.addEventListener('change', function() {
                    if (dashboardData && dashboardData.allPRs) {
                        applyFilters(dashboardData.allPRs);
                    }
                });
            }
        }

        // Setup search functionality
        function setupSearchFunction() {
            console.log('üîç ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Search Function...');
            
            const searchIcon = document.getElementById('searchIcon');
            const searchInput = document.getElementById('searchInput');
            const searchClear = document.getElementById('searchClear');
            
            if (!searchIcon || !searchInput || !searchClear) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö search elements');
                return;
            }
            
            let isSearchVisible = false;
            
            function showSearch() {
                searchInput.classList.add('active');
                searchIcon.classList.add('active');
                isSearchVisible = true;
                setTimeout(() => searchInput.focus(), 50);
            }
            
            function hideSearch() {
                searchInput.classList.remove('active');
                searchIcon.classList.remove('active');
                searchClear.classList.remove('show');
                searchInput.value = '';
                isSearchVisible = false;
                
                if (dashboardData && dashboardData.allPRs) {
                    applyFilters(dashboardData.allPRs);
                }
            }
            
            searchIcon.addEventListener('click', function() {
                if (!isSearchVisible) {
                    showSearch();
                } else if (searchInput.value === '') {
                    hideSearch();
                }
            });
            
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.trim();
                
                if (searchTerm.length > 0) {
                    searchClear.classList.add('show');
                } else {
                    searchClear.classList.remove('show');
                }
                
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }
                
                searchTimeout = setTimeout(() => {
                    if (dashboardData && dashboardData.allPRs) {
                        applyFilters(dashboardData.allPRs);
                    }
                }, 150);
            });
            
            searchClear.addEventListener('click', function() {
                hideSearch();
            });
            
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (dashboardData && dashboardData.allPRs) {
                        applyFilters(dashboardData.allPRs);
                    }
                }
                if (e.key === 'Escape') {
                    hideSearch();
                }
            });
            
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.search-container') && isSearchVisible && searchInput.value === '') {
                    hideSearch();
                }
            });
            
            console.log('‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Search Function ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        }

        // Apply sorting function
        function applySorting(allPRs) {
            const sortOption = document.getElementById('sortOption');
            const sortValue = sortOption ? sortOption.value : 'date-asc';
            
            let sortedPRs = [...allPRs];
            
            function getPRNumber(prNo) {
                if (!prNo || typeof prNo !== 'string') {
                    return 0;
                }
                return parseInt(prNo.replace(/[^0-9]/g, '')) || 0;
            }
            
            switch (sortValue) {
                case 'date-asc':
                    sortedPRs.sort((a, b) => {
                        const dateA = new Date(a.date);
                        const dateB = new Date(b.date);
                        
                        if (dateA.getTime() !== dateB.getTime()) {
                            return dateA.getTime() - dateB.getTime();
                        }
                        
                        const prNoA = getPRNumber(a.prNo);
                        const prNoB = getPRNumber(b.prNo);
                        return prNoA - prNoB;
                    });
                    break;
                    
                case 'date-desc':
                    sortedPRs.sort((a, b) => {
                        const dateA = new Date(a.date);
                        const dateB = new Date(b.date);
                        
                        if (dateA.getTime() !== dateB.getTime()) {
                            return dateB.getTime() - dateA.getTime();
                        }
                        
                        const prNoA = getPRNumber(a.prNo);
                        const prNoB = getPRNumber(b.prNo);
                        return prNoA - prNoB;
                    });
                    break;
                    
                case 'amount-desc':
                    sortedPRs.sort((a, b) => (b.amount || 0) - (a.amount || 0));
                    break;
                    
                case 'amount-asc':
                    sortedPRs.sort((a, b) => (a.amount || 0) - (b.amount || 0));
                    break;
                    
                default:
                    sortedPRs.sort((a, b) => {
                        const dateA = new Date(a.date);
                        const dateB = new Date(b.date);
                        
                        if (dateA.getTime() !== dateB.getTime()) {
                            return dateA.getTime() - dateB.getTime();
                        }
                        
                        const prNoA = getPRNumber(a.prNo);
                        const prNoB = getPRNumber(b.prNo);
                        return prNoA - prNoB;
                    });
            }
            
            return sortedPRs;
        }

        // Setup month filter
        function setupMonthFilter(allPRs) {
            const monthFilter = document.getElementById('monthFilter');
            
            if (!monthFilter) return;
            
            monthFilter.innerHTML = '<option value="all">‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>';
            
            const uniqueMonths = [...new Set(allPRs.map(pr => pr.month))].filter(month => month).sort();
            
            uniqueMonths.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthFilter.appendChild(option);
            });
            
            monthFilter.addEventListener('change', function() {
                applyFilters(dashboardData.allPRs);
            });
        }

        // Enhanced apply filters with multi-status support
        function applyFilters(allPRs) {
            console.log('üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
            
            const monthFilter = document.getElementById('monthFilter');
            const searchInput = document.getElementById('searchInput');
            
            const selectedMonth = monthFilter ? monthFilter.value : 'all';
            const searchTerm = searchInput ? searchInput.value.trim() : '';
            
            let filteredPRs = allPRs;
            
            // Filter by month
            if (selectedMonth !== 'all') {
                filteredPRs = filteredPRs.filter(pr => pr.month === selectedMonth);
            }
            
            // Filter by selected statuses
            if (selectedStatuses.size > 0) {
                filteredPRs = filteredPRs.filter(pr => {
                    const status = pr.status || 'UNKNOWN';
                    return selectedStatuses.has(status);
                });
            }
            
            // Filter by search term
            if (searchTerm !== '') {
                filteredPRs = filteredPRs.filter(pr => {
                    const item = (pr.item || '').toLowerCase();
                    const prNo = (pr.prNo || '').toLowerCase();
                    const remark = (pr.remark || '').toLowerCase();
                    const term = searchTerm.toLowerCase();
                    
                    return item.includes(term) || 
                           prNo.includes(term) || 
                           remark.includes(term);
                });
            }
            
            console.log(`üîç ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${filteredPRs.length} ‡∏à‡∏≤‡∏Å ${allPRs.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
            console.log(`üîç ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô="${selectedMonth}", ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞=[${Array.from(selectedStatuses).join(', ')}], ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤="${searchTerm}"`);
            
            // Apply sorting
            const sortedPRs = applySorting(filteredPRs);
            
            // Update table
            populateAllPRsTable(sortedPRs);
            
            // Update filter results
            updateFilterResults(filteredPRs.length, allPRs.length, searchTerm);
        }

        // Update filter results display
        function updateFilterResults(filteredCount, totalCount, searchTerm = '') {
            const tableTitle = document.querySelector('.bg-white h3');
            if (!tableTitle) return;
            
            let titleText = 'üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PR ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà PR No. ‡∏ã‡πâ‡∏≥)';
            
            if (filteredCount === totalCount && searchTerm === '') {
                tableTitle.textContent = titleText;
            } else {
                if (searchTerm !== '') {
                    if (filteredCount === 0) {
                        titleText = `üìã ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö "${searchTerm}"`;
                    } else {
                        titleText = `üìã ‡∏û‡∏ö ${filteredCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å ${totalCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: "${searchTerm}"`;
                    }
                } else {
                    titleText = `üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ PR ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÅ‡∏™‡∏î‡∏á ${filteredCount} ‡∏à‡∏≤‡∏Å ${totalCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
                }
                
                tableTitle.textContent = titleText;
            }
            
            if (searchTerm !== '') {
                tableTitle.classList.add('text-blue-700');
            } else {
                tableTitle.classList.remove('text-blue-700');
            }
        }

        // Utility functions
        function formatNumber(num) {
            if (typeof num !== 'number' || isNaN(num)) {
                return '0';
            }
            return num.toLocaleString('th-TH');
        }

        function formatCurrency(num) {
            if (typeof num !== 'number' || isNaN(num)) {
                return '0 ‡∏ø';
            }
            return num.toLocaleString('th-TH') + ' ‡∏ø';
        }

        function getStatusClass(status) {
            if (!status || typeof status !== 'string') {
                return 'status-other';
            }
            
            switch (status.toUpperCase()) {
                case 'RECEIVED':
                    return 'status-received';
                case 'PENDING':
                    return 'status-pending';
                default:
                    return 'status-other';
            }
        }
    </script>
</body>
</html>
